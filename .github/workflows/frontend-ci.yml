name: Frontend CI

on:
  push:
    branches:
      - master
    paths:
      - 'frontend/**'
      - 'api/**'
      - '.github/workflows/frontend-ci.yml'
      - '.nvmrc'
  pull_request:
    branches:
      - master
    paths:
      - 'frontend/**'
      - 'api/**'
      - '.github/workflows/frontend-ci.yml'
      - '.nvmrc'

permissions:
  contents: read

jobs:
  frontend:
    name: Frontend checks
    runs-on: ubuntu-latest
    env:
      CI: true
    defaults:
      run:
        working-directory: frontend
    steps:
      - uses: actions/checkout@v6
      - uses: actions/setup-node@v6
        with:
          node-version: '22'
          cache: npm
          cache-dependency-path: frontend/package-lock.json
      - run: npm ci
      - name: Generate API types from OpenAPI spec
        run: npm run generate:types
      - name: Check for uncommitted API type changes
        run: |
          if ! git diff --exit-code src/types/api.ts; then
            echo "❌ Error: API types are out of sync with OpenAPI specification"
            echo ""
            echo "The generated TypeScript types don't match the committed version."
            echo "This means the OpenAPI spec has changed but types weren't regenerated."
            echo ""
            echo "To fix this:"
            echo "  1. Run: npm run generate:types"
            echo "  2. Review and commit the changes to src/types/api.ts"
            echo ""
            exit 1
          fi
          echo "✅ API types are in sync with OpenAPI specification"
      - run: npm run typecheck
      - run: npm run build
      - run: npm test
