# ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒªãƒ³ã‚¯æ©Ÿèƒ½ - ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è‡ªå‹•åé›†è¨ˆç”»

## æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ã‚¿ã‚°ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆç‰¹ã«ãƒªãƒ³ã‚¯æƒ…å ±ï¼‰ã‚’**äººé–“ã®æ‰‹é–“ã‚’æœ€å°é™ã«**åé›†ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## å•é¡Œ

æ‰‹å‹•ã§ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã™ã‚‹ã®ã¯ï¼š
- âŒ æ™‚é–“ãŒã‹ã‹ã‚‹
- âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã‚„ã™ã„
- âŒ ã‚¹ã‚±ãƒ¼ãƒ«ã—ãªã„
- âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ãŒæ‚ªã„

## è§£æ±ºç­–ã®å…¨ä½“åƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿åé›†ã®3æ®µéšã‚¢ãƒ—ãƒ­ãƒ¼ãƒ                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚ Phase 1: æ‰‹å‹•å…¥åŠ›ï¼ˆåˆæœŸå®Ÿè£…ï¼‰                                    â”‚
â”‚   - ã‚¿ã‚°ä½œæˆæ™‚ã«ä»»æ„ã§ãƒªãƒ³ã‚¯ã‚’å…¥åŠ›                               â”‚
â”‚   - æœ€å°é™ã®å®Ÿè£…                                                 â”‚
â”‚                                                                 â”‚
â”‚ Phase 2: åŠè‡ªå‹•åé›†ï¼ˆæ¨å¥¨ï¼‰                                      â”‚
â”‚   - ã‚¿ã‚°åã‹ã‚‰è‡ªå‹•çš„ã«ãƒªãƒ³ã‚¯ã‚’ææ¡ˆ                               â”‚
â”‚   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç¢ºèªãƒ»é¸æŠ                                         â”‚
â”‚   - 80%ä»¥ä¸Šã®æ‰‹é–“ã‚’å‰Šæ¸›                                          â”‚
â”‚                                                                 â”‚
â”‚ Phase 3: å®Œå…¨è‡ªå‹•åé›†ï¼ˆå°†æ¥ï¼‰                                    â”‚
â”‚   - ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§è‡ªå‹•çš„ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è£œå®Œ                   â”‚
â”‚   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä½•ã‚‚ã—ãªã„                                         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Phase 2: åŠè‡ªå‹•åé›†ï¼ˆæ¨å¥¨å®Ÿè£…ï¼‰

### 1. Wikipedia URLè‡ªå‹•ç”Ÿæˆ

#### ä»•çµ„ã¿

ã‚¿ã‚°åã‹ã‚‰è‡ªå‹•çš„ã«Wikipedia URLã‚’ç”Ÿæˆï¼š

```typescript
// backend/src/services/MetadataService.ts
export class MetadataService {
  /**
   * ã‚¿ã‚°åã‹ã‚‰Wikipedia URLã‚’è‡ªå‹•ç”Ÿæˆ
   * ä¾‹: "é€²æ’ƒã®å·¨äºº" â†’ "https://ja.wikipedia.org/wiki/é€²æ’ƒã®å·¨äºº"
   */
  static generateWikipediaUrl(tagName: string, lang: string = 'ja'): string {
    const encodedName = encodeURIComponent(tagName.trim());
    return `https://${lang}.wikipedia.org/wiki/${encodedName}`;
  }
  
  /**
   * Wikipedia URLãŒå®Ÿéš›ã«å­˜åœ¨ã™ã‚‹ã‹ç¢ºèªï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   */
  static async validateWikipediaUrl(url: string): Promise<boolean> {
    try {
      const response = await fetch(url, { method: 'HEAD' });
      return response.status === 200;
    } catch {
      return false;
    }
  }
}
```

#### UIå®Ÿè£…

```tsx
// frontend/src/components/TagForm.tsx
export function TagForm() {
  const [tagName, setTagName] = useState('');
  const [suggestedLinks, setSuggestedLinks] = useState({});
  
  // ã‚¿ã‚°åãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰è‡ªå‹•çš„ã«ãƒªãƒ³ã‚¯ã‚’ææ¡ˆ
  useEffect(() => {
    if (tagName.length > 2) {
      const wikipediaUrl = `https://ja.wikipedia.org/wiki/${encodeURIComponent(tagName)}`;
      setSuggestedLinks({ wikipedia: wikipediaUrl });
    }
  }, [tagName]);
  
  return (
    <form>
      <input value={tagName} onChange={(e) => setTagName(e.target.value)} />
      
      {suggestedLinks.wikipedia && (
        <div className="suggested-links">
          <p>ğŸ“– ææ¡ˆã•ã‚ŒãŸãƒªãƒ³ã‚¯:</p>
          <button onClick={() => addLink('wikipedia', suggestedLinks.wikipedia)}>
            Wikipedia ãƒªãƒ³ã‚¯ã‚’è¿½åŠ 
          </button>
        </div>
      )}
    </form>
  );
}
```

### 2. Wikidata APIçµ±åˆ

#### ä»•çµ„ã¿

Wikidataã¯Wikipediaã®æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã€å¤šãã®æƒ…å ±ã‚’è‡ªå‹•å–å¾—ã§ãã¾ã™ï¼š

```typescript
// backend/src/services/WikidataService.ts
export class WikidataService {
  /**
   * ã‚¿ã‚°åã‹ã‚‰Wikidataã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’æ¤œç´¢
   */
  static async searchEntity(tagName: string): Promise<WikidataEntity | null> {
    const url = `https://www.wikidata.org/w/api.php?action=wbsearchentities&search=${encodeURIComponent(tagName)}&language=ja&format=json`;
    
    const response = await fetch(url);
    const data = await response.json();
    
    if (data.search && data.search.length > 0) {
      return data.search[0]; // æœ€åˆã®çµæœã‚’è¿”ã™
    }
    return null;
  }
  
  /**
   * Wikidataã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£IDã‹ã‚‰è©³ç´°æƒ…å ±ã‚’å–å¾—
   */
  static async getEntityDetails(entityId: string): Promise<EntityDetails> {
    const url = `https://www.wikidata.org/w/api.php?action=wbgetentities&ids=${entityId}&format=json&props=claims|sitelinks`;
    
    const response = await fetch(url);
    const data = await response.json();
    const entity = data.entities[entityId];
    
    return {
      wikidataId: entityId,
      officialWebsite: this.extractClaim(entity, 'P856'), // P856 = official website
      imdb: this.extractClaim(entity, 'P345'),            // P345 = IMDb ID
      myanimelist: this.extractClaim(entity, 'P4084'),     // P4084 = MyAnimeList ID
      wikipedia: entity.sitelinks?.jawiki?.url,
      // ... ä»–ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
    };
  }
  
  private static extractClaim(entity: any, propertyId: string): string | null {
    const claims = entity.claims?.[propertyId];
    if (claims && claims.length > 0) {
      return claims[0].mainsnak.datavalue.value;
    }
    return null;
  }
}
```

#### å–å¾—ã§ãã‚‹æƒ…å ±ã®ä¾‹

Wikidataã‹ã‚‰è‡ªå‹•çš„ã«å–å¾—ã§ãã‚‹æƒ…å ±ï¼š

| ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ | Wikidata ID | ä¾‹ |
|-----------|-------------|---|
| å…¬å¼ã‚µã‚¤ãƒˆ | P856 | https://shingeki.tv/ |
| IMDb ID | P345 | tt2560140 |
| MyAnimeList ID | P4084 | 16498 |
| AniList ID | P8729 | 16498 |
| Wikipedia (å„è¨€èª) | sitelinks | ja, en, etc. |
| ç™ºå£²æ—¥/æ”¾é€æ—¥ | P577 | 2013-04-07 |
| åˆ¶ä½œä¼šç¤¾ | P272 | Studio WIT |
| ã‚¸ãƒ£ãƒ³ãƒ« | P136 | Action, Dark Fantasy |

### 3. ã‚¿ã‚°ä½œæˆæ™‚ã®è‡ªå‹•ææ¡ˆãƒ•ãƒ­ãƒ¼

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¿ã‚°åã‚’å…¥åŠ›
   â”‚
   â–¼
2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§Wikipedia URLã‚’è‡ªå‹•ç”Ÿæˆ
   â”‚
   â–¼
3. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã«ã€Œãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ææ¡ˆã€ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
   â”‚ POST /api/tags/suggest-metadata
   â”‚ { "name": "é€²æ’ƒã®å·¨äºº" }
   â”‚
   â–¼
4. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§Wikidata APIã‚’å‘¼ã³å‡ºã—
   â”‚
   â–¼
5. ææ¡ˆã•ã‚ŒãŸãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™
   â”‚ {
   â”‚   "suggestions": {
   â”‚     "official": "https://shingeki.tv/",
   â”‚     "wikipedia": "https://ja.wikipedia.org/wiki/é€²æ’ƒã®å·¨äºº",
   â”‚     "myanimelist": "https://myanimelist.net/anime/16498/",
   â”‚     "year": 2013,
   â”‚     "category": "anime"
   â”‚   }
   â”‚ }
   â”‚
   â–¼
6. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ææ¡ˆã‚’è¡¨ç¤º
   â”‚
   â–¼
7. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç¢ºèªãƒ»é¸æŠ
   â”‚ [âœ“] å…¬å¼ã‚µã‚¤ãƒˆ
   â”‚ [âœ“] Wikipedia
   â”‚ [âœ“] MyAnimeList
   â”‚ [âœ—] IMDb (ä¸è¦ãªã®ã§é™¤å¤–)
   â”‚
   â–¼
8. ã‚¿ã‚°ä½œæˆæ™‚ã«é¸æŠã•ã‚ŒãŸãƒªãƒ³ã‚¯ã‚’ä¿å­˜
```

### 4. APIå®Ÿè£…ä¾‹

#### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: POST /api/tags/suggest-metadata

```typescript
// backend/src/routes/tags.ts
app.post('/api/tags/suggest-metadata', async (c) => {
  const { name } = await c.req.json();
  
  if (!name || name.length < 2) {
    return c.json({ error: 'Tag name is required' }, 400);
  }
  
  try {
    // Wikidataæ¤œç´¢
    const entity = await WikidataService.searchEntity(name);
    
    if (!entity) {
      // Wikidataã§è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯Wikipediaã®ã¿ææ¡ˆ
      return c.json({
        suggestions: {
          wikipedia: MetadataService.generateWikipediaUrl(name),
        }
      });
    }
    
    // Wikidataè©³ç´°å–å¾—
    const details = await WikidataService.getEntityDetails(entity.id);
    
    // ãƒªãƒ³ã‚¯ã‚’æ§‹ç¯‰
    const suggestions: any = {};
    
    if (details.officialWebsite) {
      suggestions.official = details.officialWebsite;
    }
    
    if (details.wikipedia) {
      suggestions.wikipedia = details.wikipedia;
    }
    
    if (details.myanimelist) {
      suggestions.myanimelist = `https://myanimelist.net/anime/${details.myanimelist}/`;
    }
    
    if (details.imdb) {
      suggestions.imdb = `https://www.imdb.com/title/${details.imdb}/`;
    }
    
    return c.json({ suggestions });
    
  } catch (error) {
    console.error('Failed to fetch metadata suggestions:', error);
    
    // ã‚¨ãƒ©ãƒ¼æ™‚ã¯Wikipediaã®ã¿ææ¡ˆ
    return c.json({
      suggestions: {
        wikipedia: MetadataService.generateWikipediaUrl(name),
      }
    });
  }
});
```

### 5. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ä¾‹

```tsx
// frontend/src/components/TagForm.tsx
export function TagForm({ onSuccess }: TagFormProps) {
  const [name, setName] = useState('');
  const [suggestions, setSuggestions] = useState<MetadataSuggestions | null>(null);
  const [selectedLinks, setSelectedLinks] = useState<string[]>([]);
  const [loading, setLoading] = useState(false);
  
  // ã‚¿ã‚°åå¤‰æ›´æ™‚ã«è‡ªå‹•çš„ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ææ¡ˆ
  const fetchSuggestions = async (tagName: string) => {
    if (tagName.length < 2) {
      setSuggestions(null);
      return;
    }
    
    setLoading(true);
    try {
      const response = await api.POST('/tags/suggest-metadata', {
        body: { name: tagName }
      });
      
      if (response.data) {
        setSuggestions(response.data.suggestions);
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å…¨ã¦é¸æŠ
        setSelectedLinks(Object.keys(response.data.suggestions));
      }
    } catch (error) {
      console.error('Failed to fetch suggestions:', error);
    } finally {
      setLoading(false);
    }
  };
  
  // ãƒ‡ãƒã‚¦ãƒ³ã‚¹ä»˜ãã§ææ¡ˆå–å¾—
  useEffect(() => {
    const timer = setTimeout(() => {
      fetchSuggestions(name);
    }, 500); // 500mså¾…æ©Ÿ
    
    return () => clearTimeout(timer);
  }, [name]);
  
  const handleSubmit = async () => {
    // é¸æŠã•ã‚ŒãŸãƒªãƒ³ã‚¯ã®ã¿ã‚’å«ã‚€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
    const links: any = {};
    selectedLinks.forEach(key => {
      if (suggestions?.[key]) {
        links[key] = suggestions[key];
      }
    });
    
    const metadata = { links };
    
    // ã‚¿ã‚°ä½œæˆ
    await api.POST('/tags', {
      body: { name, metadata }
    });
    
    onSuccess();
  };
  
  return (
    <form onSubmit={handleSubmit}>
      <div>
        <label>ã‚¿ã‚°å</label>
        <input
          value={name}
          onChange={(e) => setName(e.target.value)}
          placeholder="ä¾‹: é€²æ’ƒã®å·¨äºº"
        />
      </div>
      
      {loading && <div>ææ¡ˆã‚’å–å¾—ä¸­...</div>}
      
      {suggestions && Object.keys(suggestions).length > 0 && (
        <div className="metadata-suggestions">
          <h3>ğŸ“ è‡ªå‹•çš„ã«è¦‹ã¤ã‹ã£ãŸãƒªãƒ³ã‚¯</h3>
          <p className="text-sm text-gray-600">
            å¿…è¦ãªãƒªãƒ³ã‚¯ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„
          </p>
          
          {Object.entries(suggestions).map(([key, url]) => (
            <div key={key} className="flex items-center gap-2">
              <input
                type="checkbox"
                checked={selectedLinks.includes(key)}
                onChange={(e) => {
                  if (e.target.checked) {
                    setSelectedLinks([...selectedLinks, key]);
                  } else {
                    setSelectedLinks(selectedLinks.filter(k => k !== key));
                  }
                }}
              />
              <span className="font-medium">{getLinkLabel(key)}</span>
              <a
                href={url}
                target="_blank"
                rel="noopener noreferrer"
                className="text-sm text-blue-600 truncate"
              >
                {url}
              </a>
            </div>
          ))}
        </div>
      )}
      
      <button type="submit">ã‚¿ã‚°ã‚’ä½œæˆ</button>
    </form>
  );
}

function getLinkLabel(key: string): string {
  const labels: Record<string, string> = {
    official: 'ğŸŒ å…¬å¼ã‚µã‚¤ãƒˆ',
    wikipedia: 'ğŸ“– Wikipedia',
    myanimelist: 'ğŸ“Š MyAnimeList',
    imdb: 'ğŸ¬ IMDb',
    // ...
  };
  return labels[key] || key;
}
```

## Phase 3: å®Œå…¨è‡ªå‹•åé›†ï¼ˆå°†æ¥ï¼‰

### 1. ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¸ãƒ§ãƒ–ã§ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è£œå®Œ

```typescript
// backend/src/jobs/enrichMetadata.ts
export async function enrichTagMetadata(tagId: string) {
  const tag = await db.get('SELECT * FROM tags WHERE id = ?', tagId);
  
  if (!tag) return;
  
  // æ—¢ã«ãƒªãƒ³ã‚¯ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
  const metadata = TagModel.parseMetadata(tag.metadata);
  if (metadata.links && Object.keys(metadata.links).length > 0) {
    return;
  }
  
  // Wikidataã‹ã‚‰è‡ªå‹•çš„ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  const entity = await WikidataService.searchEntity(tag.name);
  if (!entity) return;
  
  const details = await WikidataService.getEntityDetails(entity.id);
  
  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
  metadata.links = {
    official: details.officialWebsite,
    wikipedia: details.wikipedia,
    myanimelist: details.myanimelist ? `https://myanimelist.net/anime/${details.myanimelist}/` : undefined,
    // ...
  };
  
  // NULLå€¤ã‚’é™¤å»
  Object.keys(metadata.links).forEach(key => {
    if (!metadata.links[key]) {
      delete metadata.links[key];
    }
  });
  
  // DBã«ä¿å­˜
  await db.run(
    'UPDATE tags SET metadata = ? WHERE id = ?',
    TagModel.serializeMetadata(metadata),
    tagId
  );
}
```

### 2. Cloudflare Queues / Cron Triggersã§å®šæœŸå®Ÿè¡Œ

```typescript
// backend/src/scheduled.ts
export default {
  async scheduled(event: ScheduledEvent, env: Env, ctx: ExecutionContext) {
    // æ¯æ—¥1å›ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã‚‹ã‚¿ã‚°ã‚’è£œå®Œ
    const tags = await env.DB.prepare(
      `SELECT id, name FROM tags 
       WHERE metadata = '{}' OR json_extract(metadata, '$.links') IS NULL
       LIMIT 100`
    ).all();
    
    for (const tag of tags.results) {
      ctx.waitUntil(enrichTagMetadata(tag.id));
    }
  }
};
```

### 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”Ÿæˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‹ã‚‰ã®å­¦ç¿’

å°†æ¥çš„ã«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã«å«ã‚ãŸãƒªãƒ³ã‚¯ã‹ã‚‰å­¦ç¿’ï¼š

```typescript
// ãƒ­ã‚°ã‹ã‚‰å…¬å¼ã‚µã‚¤ãƒˆã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ç¿’
// ä¾‹: "Attack on Titan" ã®ãƒ­ã‚°ã« https://shingeki.tv/ ãŒé »ç¹ã«å«ã¾ã‚Œã‚‹
//     â†’ è‡ªå‹•çš„ã«ã‚¿ã‚°ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ 
```

## å®Ÿè£…ã®å„ªå…ˆé †ä½

### Phase 1: æ‰‹å‹•å…¥åŠ›ï¼ˆåˆæœŸå®Ÿè£…ï¼‰
- **å„ªå…ˆåº¦**: é«˜
- **å·¥æ•°**: 0.5æ—¥
- **å®Ÿè£…å†…å®¹**:
  - ã‚¿ã‚°ãƒ•ã‚©ãƒ¼ãƒ ã§ãƒªãƒ³ã‚¯ã‚’æ‰‹å‹•å…¥åŠ›ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
  - æœ€å°é™ã®å®Ÿè£…

### Phase 2: åŠè‡ªå‹•åé›†ï¼ˆæ¨å¥¨ï¼‰
- **å„ªå…ˆåº¦**: é«˜
- **å·¥æ•°**: 2-3æ—¥
- **å®Ÿè£…å†…å®¹**:
  1. Wikipedia URLè‡ªå‹•ç”Ÿæˆï¼ˆ0.5æ—¥ï¼‰
  2. Wikidata APIçµ±åˆï¼ˆ1æ—¥ï¼‰
  3. ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ææ¡ˆAPIï¼ˆ0.5æ—¥ï¼‰
  4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰UIï¼ˆ1æ—¥ï¼‰

### Phase 3: å®Œå…¨è‡ªå‹•åé›†ï¼ˆå°†æ¥ï¼‰
- **å„ªå…ˆåº¦**: ä¸­
- **å·¥æ•°**: 3-5æ—¥
- **å®Ÿè£…å†…å®¹**:
  1. ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¸ãƒ§ãƒ–ï¼ˆ1æ—¥ï¼‰
  2. Cloudflare Cronè¨­å®šï¼ˆ0.5æ—¥ï¼‰
  3. å­¦ç¿’ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆ2-3æ—¥ï¼‰

## æ‰‹é–“å‰Šæ¸›ã®åŠ¹æœ

| æ–¹æ³• | æ‰‹å‹•å…¥åŠ›æ™‚é–“ | è‡ªå‹•åŒ–å¾Œã®æ™‚é–“ | å‰Šæ¸›ç‡ |
|------|------------|--------------|--------|
| Phase 1: æ‰‹å‹•å…¥åŠ› | 5åˆ†/ã‚¿ã‚° | 5åˆ†/ã‚¿ã‚° | 0% |
| Phase 2: åŠè‡ªå‹•åé›† | 5åˆ†/ã‚¿ã‚° | 30ç§’/ã‚¿ã‚° | **90%å‰Šæ¸›** |
| Phase 3: å®Œå…¨è‡ªå‹• | 5åˆ†/ã‚¿ã‚° | 0ç§’/ã‚¿ã‚° | **100%å‰Šæ¸›** |

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ¬ãƒ¼ãƒˆåˆ¶é™

### Wikidata APIã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™

- **åˆ¶é™**: ç‰¹ã«ãªã—ï¼ˆæ¨å¥¨: 1ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ç§’ä»¥ä¸‹ï¼‰
- **å¯¾ç­–**: 
  - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ´»ç”¨
  - ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‡¦ç†
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ç›´æ¥å‘¼ã³å‡ºã—

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

```typescript
// Wikidataã®çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆ24æ™‚é–“ï¼‰
const cacheKey = `wikidata:${tagName}`;
const cached = await env.CACHE.get(cacheKey);

if (cached) {
  return JSON.parse(cached);
}

const result = await WikidataService.searchEntity(tagName);
await env.CACHE.put(cacheKey, JSON.stringify(result), { expirationTtl: 86400 });

return result;
```

## ã¾ã¨ã‚

### æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

**Phase 2ï¼ˆåŠè‡ªå‹•åé›†ï¼‰ã‚’æ¨å¥¨**ï¼š

âœ… **ãƒ¡ãƒªãƒƒãƒˆ**:
- 90%ä»¥ä¸Šã®æ‰‹é–“ã‚’å‰Šæ¸›
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç¢ºèªã§ãã‚‹ã®ã§æ­£ç¢ºæ€§ãŒé«˜ã„
- å®Ÿè£…ãŒæ¯”è¼ƒçš„ç°¡å˜ï¼ˆ2-3æ—¥ï¼‰
- å¤–éƒ¨APIã«éåº¦ã«ä¾å­˜ã—ãªã„

âœ… **å®Ÿè£…æ‰‹é †**:
1. Wikipedia URLè‡ªå‹•ç”Ÿæˆï¼ˆç°¡å˜ï¼‰
2. Wikidata APIçµ±åˆï¼ˆæ ¸å¿ƒæ©Ÿèƒ½ï¼‰
3. ã‚¿ã‚°ãƒ•ã‚©ãƒ¼ãƒ ã«UIè¿½åŠ 
4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ã‚¹ãƒˆã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†

âœ… **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“**:
```
å¾“æ¥: ã‚¿ã‚°åå…¥åŠ› â†’ å…¬å¼ã‚µã‚¤ãƒˆã‚’æ¤œç´¢ â†’ URLã‚³ãƒ”ãƒ¼ â†’ è²¼ã‚Šä»˜ã‘ â†’ Wikipediaæ¤œç´¢ â†’ ...
                (5åˆ†ã‹ã‹ã‚‹)

æ”¹å–„å¾Œ: ã‚¿ã‚°åå…¥åŠ› â†’ è‡ªå‹•çš„ã«ãƒªãƒ³ã‚¯ãŒè¡¨ç¤º â†’ ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§é¸æŠ
                (30ç§’ã§å®Œäº†)
```

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šã€äººé–“ã®æ‰‹é–“ã‚’**æœ€å°é™**ã«æŠ‘ãˆãªãŒã‚‰ã€é«˜å“è³ªãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã§ãã¾ã™ã€‚

---

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: Phase 2ã®å®Ÿè£…ã‚’é–‹å§‹ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å…ƒã«Phase 3ã®å¿…è¦æ€§ã‚’åˆ¤æ–­ã—ã¾ã™ã€‚
